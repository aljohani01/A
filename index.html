<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>ŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ÿßŸÑŸÉÿ¥Ÿàÿ¥</title>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #334155;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-yellow: #f59e0b;
            --accent-purple: #3b82f6;
            --border-radius: 12px;
            --box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --transition: all 0.2s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans Arabic', Roboto, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            padding: 16px;
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            width: 100%;
        }

        header {
            text-align: center;
            margin-bottom: 24px;
            padding: 32px 20px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: var(--text-primary);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
        }

        header h1 {
            font-size: 1.75rem;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .header-subtitle {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 24px;
        }

        .card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .card:hover {
            border-color: var(--bg-tertiary);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }

        .card-header {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .card-header.success {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
            border-bottom-color: #10b981;
        }

        .card-header.archive {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-bottom-color: #3b82f6;
        }

        .card-header.special {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-bottom-color: #3b82f6;
        }

        .card-header h2 {
            margin: 0;
            font-size: 1.15rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.3px;
        }

        .card-header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .card-body {
            padding: 0;
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .toggle-btn.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            max-width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            background: var(--bg-card);
        }

        th, td {
            padding: 10px 6px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #eventsTable th:nth-child(1),
        #eventsTable td:nth-child(1) {
            width: 22%;
            min-width: 70px;
            white-space: normal;
            word-wrap: break-word;
        }

        #eventsTable th:nth-child(2),
        #eventsTable td:nth-child(2) {
            width: 20%;
            min-width: 85px;
        }

        #eventsTable th:nth-child(3),
        #eventsTable td:nth-child(3) {
            width: 13%;
            min-width: 50px;
        }

        #eventsTable th:nth-child(4),
        #eventsTable td:nth-child(4) {
            width: 13%;
            min-width: 50px;
        }

        #eventsTable th:nth-child(5),
        #eventsTable td:nth-child(5) {
            width: 20%;
            min-width: 65px;
            white-space: normal;
            word-wrap: break-word;
        }

        #eventsTable th:nth-child(6),
        #eventsTable td:nth-child(6) {
            width: 12%;
            min-width: 45px;
        }

        #specialEventsTable th:nth-child(1),
        #specialEventsTable td:nth-child(1) {
            width: 40%;
            min-width: 100px;
            white-space: normal;
            word-wrap: break-word;
        }

        #specialEventsTable th:nth-child(2),
        #specialEventsTable td:nth-child(2) {
            width: 35%;
            min-width: 90px;
        }

        #specialEventsTable th:nth-child(3),
        #specialEventsTable td:nth-child(3) {
            width: 20%;
            min-width: 60px;
        }

        #specialEventsTable th:nth-child(4),
        #specialEventsTable td:nth-child(4) {
            width: 15%;
            min-width: 45px;
        }

        #paymentsTable th:nth-child(1),
        #paymentsTable td:nth-child(1) {
            width: 70%;
            min-width: 100px;
            white-space: normal;
            word-wrap: break-word;
        }

        #paymentsTable th:nth-child(2),
        #paymentsTable td:nth-child(2) {
            width: 25%;
            min-width: 70px;
        }

        #paymentsTable th:nth-child(3),
        #paymentsTable td:nth-child(3) {
            width: 15%;
            min-width: 45px;
        }

        thead {
            background: var(--bg-secondary);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tbody tr {
            transition: background-color 0.15s ease;
        }

        tbody tr:nth-child(even) {
            background-color: rgba(51, 65, 85, 0.3);
        }

        tbody tr:hover {
            background-color: var(--bg-hover);
        }

        tfoot {
            background: var(--bg-secondary);
            font-weight: 600;
            border-top: 2px solid var(--accent-green);
        }

        tfoot td {
            padding: 12px 6px;
            font-size: 0.85rem;
            color: var(--accent-green);
        }

        .editable {
            cursor: pointer;
            transition: var(--transition);
            border-radius: 6px;
            padding: 6px 4px;
            min-height: 28px;
        }

        .editable:hover {
            background-color: rgba(251, 191, 36, 0.2);
            outline: 2px solid var(--accent-yellow);
        }

        .editable:focus {
            background-color: var(--bg-secondary);
            outline: 2px solid var(--accent-blue);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.875rem;
            letter-spacing: 0.3px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn-sm {
            padding: 7px 14px;
            font-size: 0.8rem;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--accent-red);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--accent-yellow);
            color: var(--bg-primary);
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-purple {
            background: var(--accent-blue);
            color: white;
        }

        .btn-purple:hover {
            background: #2563eb;
        }

        .btn-outline {
            background: rgba(255, 255, 255, 0.1);
            border: 1.5px solid rgba(255, 255, 255, 0.3);
            color: var(--text-primary);
            backdrop-filter: blur(10px);
        }

        .btn-outline:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--accent-red);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 6px;
            transition: var(--transition);
            border-radius: 6px;
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background-color: rgba(239, 68, 68, 0.2);
            transform: scale(1.1);
        }

        .summary-card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-top: 24px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            border: 1px solid var(--border-color);
        }

        .summary-item {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .summary-item:hover {
            transform: translateY(-2px);
            border-color: var(--bg-tertiary);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }

        .summary-item:nth-child(1) {
            border-right: 4px solid var(--accent-blue);
        }

        .summary-item:nth-child(2) {
            border-right: 4px solid var(--accent-green);
        }

        .summary-item:nth-child(3) {
            border-right: 4px solid var(--text-secondary);
        }

        .summary-item h3 {
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .summary-value small {
            font-size: 0.75rem;
            color: var(--text-muted);
            display: block;
            margin-top: 6px;
            font-weight: 500;
        }

        .positive {
            color: var(--accent-green);
        }

        .negative {
            color: var(--accent-red);
        }

        .archive-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(8px);
            z-index: 2000;
            padding: 16px;
            overflow-y: auto;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .archive-container {
            max-width: 900px;
            margin: 20px auto;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color);
        }

        .archive-item {
            background: var(--bg-secondary);
            padding: 18px;
            margin-bottom: 18px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            border-right: 4px solid var(--accent-blue);
            transition: var(--transition);
        }

        .archive-item:hover {
            transform: translateX(-4px);
            border-color: var(--bg-tertiary);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }

        .archive-item h3 {
            color: var(--text-primary);
            margin-bottom: 14px;
            font-size: 1.15rem;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .archive-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 14px 0;
        }

        .stat-box {
            background: var(--bg-primary);
            padding: 14px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .stat-box:hover {
            border-color: var(--accent-blue);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 6px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .date-display {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            padding: 8px 14px;
            border-radius: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            display: inline-block;
            transition: var(--transition);
            direction: ltr;
            unicode-bidi: embed;
            text-align: center;
            min-width: 120px;
            font-family: monospace;
        }

        .date-display:hover {
            background: var(--bg-hover);
            border-color: var(--accent-blue);
        }

        .date-input {
            width: 165px;
            padding: 8px 12px;
            border: 2px solid var(--accent-blue);
            border-radius: 8px;
            font-size: 0.9rem;
            text-align: center;
            font-family: inherit;
            font-weight: 600;
            background: var(--bg-secondary);
            color: var(--text-primary);
            direction: ltr;
            font-family: monospace;
        }

        .date-input:focus {
            outline: none;
            border-color: var(--accent-green);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
        }

        footer {
            text-align: center;
            padding: 24px 20px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 24px;
            border: 1px solid var(--border-color);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .footer-info {
            flex: 1;
            text-align: right;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .footer-info p {
            line-height: 1.7;
        }

        .footer-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .admin-icon {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--border-color);
        }

        .admin-icon:hover {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            transform: scale(1.05);
        }

        .admin-icon.admin-active {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        #saveDataBtn {
            display: none;
        }

        .admin-mode #saveDataBtn {
            display: inline-flex;
        }

        .login-modal, .token-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(8px);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .login-container, .token-container {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            padding: 28px;
            width: 100%;
            max-width: 420px;
            border: 1px solid var(--border-color);
        }

        .login-container h2, .token-container h2 {
            text-align: center;
            margin-bottom: 24px;
            color: var(--text-primary);
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.95rem;
            font-family: inherit;
            transition: var(--transition);
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 14px;
            flex-wrap: wrap;
        }

        .full-width-btn {
            width: 100%;
            margin-top: 10px;
        }

        .hidden {
            display: none !important;
        }

        .admin-only {
            display: none;
        }

        .admin-mode .admin-only {
            display: block;
        }

        .admin-mode .admin-show {
            display: inline-flex;
        }

        .admin-only-column {
            display: none;
        }

        .admin-mode .admin-only-column {
            display: table-cell;
        }

        .progress-container {
            margin: 18px 0;
            height: 8px;
            background-color: var(--bg-secondary);
            border-radius: 50px;
            overflow: hidden;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
            width: 0;
            transition: width 0.4s ease;
        }

        .edit-mode-badge {
            position: fixed;
            top: 12px;
            right: 12px;
            background: var(--accent-yellow);
            color: var(--bg-primary);
            padding: 8px 14px;
            border-radius: 50px;
            font-size: 0.8rem;
            display: none;
            align-items: center;
            gap: 6px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
            font-weight: 600;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--accent-green);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 4000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 300px;
            font-size: 0.9rem;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: var(--accent-red);
        }

        .toast.warning {
            background: var(--accent-yellow);
            color: var(--bg-primary);
        }

        @media (max-width: 768px) {
            .summary-card {
                grid-template-columns: 1fr;
            }

            .summary-value {
                font-size: 1.75rem;
            }

            .footer-content {
                flex-direction: column;
                gap: 14px;
            }

            .footer-info {
                text-align: center;
            }

            .archive-stats {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.75rem;
            }

            th, td {
                padding: 8px 4px;
            }

            .card-header-actions {
                flex-direction: column;
                gap: 6px;
            }

            .toast {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
            }

            header {
                padding: 24px 16px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            .card-header {
                padding: 14px 16px;
            }

            .summary-value {
                font-size: 1.5rem;
            }

            table {
                font-size: 0.7rem;
            }

            th {
                font-size: 0.7rem;
            }

            .date-display {
                min-width: 100px;
                font-size: 0.8rem;
                padding: 6px 10px;
            }
        }

        @media (max-width: 600px) {
            .container {
                max-width: 100vw;
                overflow-x: hidden;
            }

            .table-container {
                margin: 0;
            }

            .card {
                margin: 0;
            }
        }

        @supports (-webkit-touch-callout: none) {
            body {
                padding-bottom: calc(80px + env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="edit-mode-badge" id="editModeBadge">
        <span>Ÿàÿ∂ÿπ ÿßŸÑÿ™ÿπÿØŸäŸÑ</span>
    </div>

    <div class="container">
        <header>
            <h1>ŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ÿßŸÑŸÉÿ¥Ÿàÿ¥</h1>
            <p class="header-subtitle"></p>
        </header>

        <div class="cards-container">
            <div class="card" id="mainEventsCard">
                <div class="card-header">
                    <h2>ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿßÿ™</h2>
                    <div class="card-header-actions">
                        <button id="toggleEventsBtn" class="toggle-btn">
                            <span>ÿßŸÑÿ™ÿ®ÿØŸäŸÑ</span>
                        </button>
                        <button id="addEventBtn" class="btn btn-primary btn-sm admin-only">
                            ÿ•ÿ∂ÿßŸÅÿ©
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table id="eventsTable">
                            <thead>
                                <tr>
                                    <th>ÿßŸÑÿ•ÿ≥ŸÖ</th>
                                    <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                                    <th>ÿßŸÑŸÖÿ®ŸÑÿ∫</th>
                                    <th>ÿ•ÿ∂ÿßŸÅÿ©</th>
                                    <th>ŸÖŸÜ</th>
                                    <th class="admin-only-column">ÿ≠ÿ∞ŸÅ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="3">ÿßŸÑŸÖÿ¨ŸÖŸàÿπ</td>
                                    <td colspan="2" id="eventsTotal">0</td>
                                    <td class="admin-only-column"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card hidden" id="specialEventsCard">
                <div class="card-header special">
                    <h2>ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ÿßŸÑÿ™Ÿä ÿ≠ÿ∂ÿ±Ÿáÿß ÿ£ÿ®Ÿà ÿÆÿßŸÑÿØ</h2>
                    <div class="card-header-actions">
                        <button id="toggleBackBtn" class="toggle-btn">
                            <span>ÿßŸÑÿ™ÿ®ÿØŸäŸÑ</span>
                        </button>
                        <button id="addSpecialEventBtn" class="btn btn-purple btn-sm admin-only">
                            ÿ•ÿ∂ÿßŸÅÿ©
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table id="specialEventsTable">
                            <thead>
                                <tr>
                                    <th>ÿßŸÑÿ•ÿ≥ŸÖ</th>
                                    <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                                    <th>ÿßŸÑŸÖÿ®ŸÑÿ∫</th>
                                    <th class="admin-only-column">ÿ≠ÿ∞ŸÅ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="2">ÿßŸÑŸÖÿ¨ŸÖŸàÿπ</td>
                                    <td id="specialEventsTotal">0 ÿ±ŸäÿßŸÑ</td>
                                    <td class="admin-only-column"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header success">
                    <h2>ÿßŸÑÿØŸÅÿπÿßÿ™</h2>
                    <button id="addPaymentBtn" class="btn btn-success btn-sm admin-only">
                        ÿ•ÿ∂ÿßŸÅÿ©
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table id="paymentsTable">
                            <thead>
                                <tr>
                                    <th>ÿßŸÑÿ•ÿ≥ŸÖ</th>
                                    <th>ÿßŸÑŸÖÿ®ŸÑÿ∫</th>
                                    <th class="admin-only-column">ÿ≠ÿ∞ŸÅ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                            <tfoot>
                                <tr>
                                    <td>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</td>
                                    <td colspan="2">
                                        <span id="dateDisplay" class="date-display"></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿØŸÅÿπÿßÿ™</td>
                                    <td colspan="2" id="paymentsTotal">0</td>
                                </tr>
                                <tr>
                                    <td>ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</td>
                                    <td colspan="2" id="remainingAmount">
                                        <span class="positive">0</span>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header archive">
                <h2>ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ</h2>
                <button id="viewArchiveBtn" class="btn btn-outline btn-sm">
                    ÿπÿ±ÿ∂
                </button>
            </div>
            <div class="card-body admin-only" style="padding: 16px;">
                <button id="startNewCycleBtn" class="btn btn-warning full-width-btn">
                    ÿ£ÿ±ÿ¥ŸÅÿ© ŸàÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØ
                </button>
            </div>
        </div>

        <div class="summary-card">
            <div class="summary-item">
                <h3>ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿßÿ™</h3>
                <div class="summary-value" id="summaryEvents">0</div>
                <small>ÿ±ŸäÿßŸÑ</small>
            </div>
            <div class="summary-item">
                <h3>ÿßŸÑÿØŸÅÿπÿßÿ™</h3>
                <div class="summary-value" id="summaryPayments">0</div>
                <small>ÿ±ŸäÿßŸÑ</small>
            </div>
            <div class="summary-item">
                <h3>ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</h3>
                <div class="summary-value" id="summaryRemaining">
                    <span class="positive">0</span>
                </div>
                <small>ÿ±ŸäÿßŸÑ</small>
            </div>
        </div>

        <footer>
            <div class="footer-content">
                <div class="footer-info">
                    <p>¬© <span id="currentYear">2025</span> ŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ÿßŸÑŸÉÿ¥Ÿàÿ¥</p>
                    <p style="margin-top: 6px;">ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: <span id="lastUpdate">---</span></p>
                </div>
                <div class="footer-controls">
                    <div class="admin-icon" id="adminLoginBtn" title="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ">
                        üîí
                    </div>
                    <button class="btn btn-success admin-only" id="saveDataBtn">
                        ÿ≠ŸÅÿ∏
                    </button>
                    <button class="btn btn-danger btn-sm admin-only" id="logoutBtn">
                        ÿÆÿ±Ÿàÿ¨
                    </button>
                </div>
            </div>
        </footer>
    </div>

    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <h2>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</h2>
            <div class="form-group">
                <label for="username">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</label>
                <input type="text" id="username" placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ">
            </div>
            <div class="form-group">
                <label for="password">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                <input type="password" id="password" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±">
            </div>
            <button class="btn btn-primary full-width-btn" id="loginBtn">
                ÿØÿÆŸàŸÑ
            </button>
            <button class="btn btn-outline full-width-btn" id="closeLoginBtn">
                ÿ•ŸÑÿ∫ÿßÿ°
            </button>
        </div>
    </div>

    <div class="token-modal" id="tokenModal">
        <div class="token-container">
            <h2>ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÑŸâ GitHub</h2>
            <div class="form-group">
                <label for="githubToken">GitHub Personal Access Token</label>
                <input type="password" id="githubToken" placeholder="ÿ£ÿØÿÆŸÑ Token ŸáŸÜÿß">
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">
                    
                </div>
            </div>
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <button class="btn btn-success full-width-btn" id="saveToGitHubBtn">
                ÿ≠ŸÅÿ∏ ÿπŸÑŸâ GitHub
            </button>
            <button class="btn btn-primary full-width-btn" id="showDataBtn">
                ŸÜÿ≥ÿÆ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            </button>
            <button class="btn btn-outline full-width-btn" id="closeTokenBtn">
                ÿ•ŸÑÿ∫ÿßÿ°
            </button>
        </div>
    </div>

    <script>
        // Configuration
        const ADMIN_USERNAME = 'abdulaziz';
        const ADMIN_PASSWORD = 'ySRgq44qThaYm0d';
        const DATA_FILE_URL = 'data.json';
        const GITHUB_API_URL = 'https://api.github.com/repos/aljohani01/A/contents/data.json';

        // Global State
        let isAdmin = false;
        let editingArchiveIndex = null;
        let currentView = 'main';

        // DOM Elements
        const mainEventsCard = document.getElementById('mainEventsCard');
        const specialEventsCard = document.getElementById('specialEventsCard');
        const eventsTableBody = document.querySelector('#eventsTable tbody');
        const specialEventsTableBody = document.querySelector('#specialEventsTable tbody');
        const paymentsTableBody = document.querySelector('#paymentsTable tbody');
        const eventsTotalEl = document.getElementById('eventsTotal');
        const specialEventsTotalEl = document.getElementById('specialEventsTotal');
        const paymentsTotalEl = document.getElementById('paymentsTotal');
        const remainingAmountEl = document.getElementById('remainingAmount');
        const summaryEventsEl = document.getElementById('summaryEvents');
        const summaryPaymentsEl = document.getElementById('summaryPayments');
        const summaryRemainingEl = document.getElementById('summaryRemaining');
        const currentYearEl = document.getElementById('currentYear');
        const dateDisplayEl = document.getElementById('dateDisplay');
        const lastUpdateEl = document.getElementById('lastUpdate');
        const editModeBadge = document.getElementById('editModeBadge');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        
        // Buttons
        const toggleEventsBtn = document.getElementById('toggleEventsBtn');
        const toggleBackBtn = document.getElementById('toggleBackBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const addEventBtn = document.getElementById('addEventBtn');
        const addSpecialEventBtn = document.getElementById('addSpecialEventBtn');
        const addPaymentBtn = document.getElementById('addPaymentBtn');
        const saveDataBtn = document.getElementById('saveDataBtn');
        const startNewCycleBtn = document.getElementById('startNewCycleBtn');
        const viewArchiveBtn = document.getElementById('viewArchiveBtn');
        
        // Modals
        const loginModal = document.getElementById('loginModal');
        const tokenModal = document.getElementById('tokenModal');
        const loginBtn = document.getElementById('loginBtn');
        const closeLoginBtn = document.getElementById('closeLoginBtn');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const githubTokenInput = document.getElementById('githubToken');
        const saveToGitHubBtn = document.getElementById('saveToGitHubBtn');
        const showDataBtn = document.getElementById('showDataBtn');
        const closeTokenBtn = document.getElementById('closeTokenBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');

        // Helper Functions
        function showToast(message, type = 'success', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, duration);
        }

        function toEnglishNumerals(str) {
            const arabicNumerals = ['Ÿ†', 'Ÿ°', 'Ÿ¢', 'Ÿ£', 'Ÿ§', 'Ÿ•', 'Ÿ¶', 'Ÿß', 'Ÿ®', 'Ÿ©'];
            const englishNumerals = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            
            let result = str.toString();
            for (let i = 0; i < arabicNumerals.length; i++) {
                result = result.replace(new RegExp(arabicNumerals[i], 'g'), englishNumerals[i]);
            }
            return result;
        }

        function getHijriDate() {
            const today = new Date();
            const hijriDate = today.toLocaleDateString('ar-SA-u-ca-islamic', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
            
            const year = toEnglishNumerals(hijriDate.split('/')[2]);
            const month = toEnglishNumerals(hijriDate.split('/')[0]);
            const day = toEnglishNumerals(hijriDate.split('/')[1]);
            
            return `${year}/${month.padStart(2, '0')}/${day.padStart(2, '0')}`;
        }

        function formatHijriDate(date) {
            if (!date || date.toString().trim() === '') return getHijriDate();
            
            let dateStr = toEnglishNumerals(date.toString());
            dateStr = dateStr.replace(/[ŸáŸÄ\s\u0600-\u06FF]/g, '');
            dateStr = dateStr.replace(/[^\d\/]/g, '');
            dateStr = dateStr.replace(/\/+/g, '/').replace(/^\//, '').replace(/\/$/, '');
            
            if (dateStr.includes('/')) {
                const parts = dateStr.split('/').filter(p => p !== '');
                
                if (parts.length === 3) {
                    const cleanParts = parts.map(part => part.replace(/\D/g, ''));
                    
                    if (cleanParts[0].length === 4 && cleanParts[1].length <= 2 && cleanParts[2].length <= 2) {
                        const year = cleanParts[0].padStart(4, '0');
                        const month = cleanParts[1].padStart(2, '0');
                        const day = cleanParts[2].padStart(2, '0');
                        return `${year}/${month}/${day}`;
                    } else if (cleanParts[2].length === 4 && cleanParts[0].length <= 2 && cleanParts[1].length <= 2) {
                        const year = cleanParts[2].padStart(4, '0');
                        const month = cleanParts[1].padStart(2, '0');
                        const day = cleanParts[0].padStart(2, '0');
                        return `${year}/${month}/${day}`;
                    }
                }
            }
            
            const numbersOnly = dateStr.replace(/\D/g, '');
            if (numbersOnly.length === 8) {
                return `${numbersOnly.slice(0,4)}/${numbersOnly.slice(4,6)}/${numbersOnly.slice(6,8)}`;
            }
            
            return getHijriDate();
        }

        function validateHijriDate(dateStr) {
            dateStr = toEnglishNumerals(dateStr);
            dateStr = dateStr.replace(/[ŸáŸÄ\s\u0600-\u06FF]/g, '');
            const cleanStr = dateStr.replace(/[^\d\/]/g, '');
            
            if (!cleanStr.includes('/')) return false;
            
            const parts = cleanStr.split('/').filter(p => p !== '');
            if (parts.length !== 3) return false;
            
            const cleanParts = parts.map(part => part.replace(/\D/g, ''));
            
            for (let part of cleanParts) {
                if (!/^\d+$/.test(part)) {
                    return false;
                }
            }
            
            let yearPart, monthPart, dayPart;
            
            if (cleanParts[0].length === 4) {
                yearPart = cleanParts[0];
                monthPart = cleanParts[1];
                dayPart = cleanParts[2];
            } else if (cleanParts[1].length === 4) {
                yearPart = cleanParts[1];
                monthPart = cleanParts[0];
                dayPart = cleanParts[2];
            } else if (cleanParts[2].length === 4) {
                yearPart = cleanParts[2];
                monthPart = cleanParts[1];
                dayPart = cleanParts[0];
            } else {
                return false;
            }
            
            const year = parseInt(yearPart);
            const month = parseInt(monthPart);
            const day = parseInt(dayPart);
            
            if (isNaN(year) || isNaN(month) || isNaN(day)) return false;
            if (year < 1400 || year > 1500) return false;
            if (month < 1 || month > 12) return false;
            if (day < 1 || day > 30) return false;
            
            return true;
        }

        function toggleView() {
            if (currentView === 'main') {
                mainEventsCard.classList.add('hidden');
                specialEventsCard.classList.remove('hidden');
                currentView = 'special';
            } else {
                mainEventsCard.classList.remove('hidden');
                specialEventsCard.classList.add('hidden');
                currentView = 'main';
            }
        }

        async function initApp() {
            currentYearEl.textContent = new Date().getFullYear();
            try {
                await loadDataFromGitHub();
                updateLastUpdate();
                setupEventListeners();
                renderData();
                showToast('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:', error);
                showToast('ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'error');
            }
        }

        async function loadDataFromGitHub() {
            try {
                const response = await fetch(`${DATA_FILE_URL}?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error('ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                
                const data = await response.json();
                window.appData = data;
                
                if (!window.appData.currentCycle) {
                    window.appData = {
                        currentCycle: {
                            events: window.appData.events || [],
                            specialEvents: [],
                            payments: window.appData.payments || [],
                            currentDate: window.appData.currentDate || getHijriDate(),
                            startDate: getHijriDate()
                        },
                        archive: window.appData.archive || [],
                        lastUpdate: window.appData.lastUpdate
                    };
                }

                window.appData.currentCycle.events = window.appData.currentCycle.events.map(event => ({
                    name: event.name || '',
                    date: formatHijriDate(event.date || getHijriDate()),
                    amount: event.amount || 0,
                    additionalAmount: event.additionalAmount || 0,
                    addedBy: event.addedBy || ''
                }));

                window.appData.currentCycle.specialEvents = (window.appData.currentCycle.specialEvents || []).map(event => ({
                    name: event.name || '',
                    date: formatHijriDate(event.date || getHijriDate()),
                    amount: event.amount || 0
                }));

                window.appData.currentCycle.currentDate = formatHijriDate(window.appData.currentCycle.currentDate || getHijriDate());
                window.appData.currentCycle.startDate = formatHijriDate(window.appData.currentCycle.startDate || getHijriDate());
                
                dateDisplayEl.textContent = window.appData.currentCycle.currentDate;
                
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™:', error);
                window.appData = {
                    currentCycle: {
                        events: [],
                        specialEvents: [],
                        payments: [],
                        currentDate: getHijriDate(),
                        startDate: getHijriDate()
                    },
                    archive: [],
                    lastUpdate: null
                };
                dateDisplayEl.textContent = getHijriDate();
            }
        }

        function updateLastUpdate() {
            if (window.appData.lastUpdate) {
                lastUpdateEl.textContent = window.appData.lastUpdate;
            } else {
                lastUpdateEl.textContent = '---';
            }
        }

        function setupEventListeners() {
            toggleEventsBtn.addEventListener('click', toggleView);
            toggleBackBtn.addEventListener('click', toggleView);

            adminLoginBtn.addEventListener('click', () => {
                loginModal.style.display = 'flex';
                usernameInput.focus();
            });

            loginBtn.addEventListener('click', login);
            
            closeLoginBtn.addEventListener('click', () => {
                loginModal.style.display = 'none';
            });

            logoutBtn.addEventListener('click', logout);
            addEventBtn.addEventListener('click', addNewEvent);
            addSpecialEventBtn.addEventListener('click', addNewSpecialEvent);
            addPaymentBtn.addEventListener('click', addNewPayment);
            startNewCycleBtn.addEventListener('click', startNewCycle);
            viewArchiveBtn.addEventListener('click', showArchive);

            dateDisplayEl.addEventListener('click', () => {
                if (!isAdmin) return;
                
                const currentDate = window.appData.currentCycle.currentDate;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.value = currentDate;
                input.className = 'date-input';
                input.placeholder = 'YYYY/MM/DD';
                dateDisplayEl.replaceWith(input);
                input.focus();
                input.select();
                
                const saveDateHandler = () => {
                    let value = input.value.trim();
                    
                    if (value && validateHijriDate(value)) {
                        value = formatHijriDate(value);
                        window.appData.currentCycle.currentDate = value;
                        dateDisplayEl.textContent = value;
                        input.replaceWith(dateDisplayEl);
                        showToast('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ', 'success');
                    } else {
                        showToast('ÿ™ÿßÿ±ŸäÿÆ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠. Ÿäÿ±ÿ¨Ÿâ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ™ŸÜÿ≥ŸäŸÇ YYYY/MM/DD', 'error', 4000);
                        input.focus();
                    }
                };
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') saveDateHandler();
                });
                
                input.addEventListener('blur', saveDateHandler);
            });

            saveDataBtn.addEventListener('click', () => {
                tokenModal.style.display = 'flex';
                githubTokenInput.focus();
            });

            saveToGitHubBtn.addEventListener('click', saveDataToGitHub);
            showDataBtn.addEventListener('click', showDataForCopy);
            
            closeTokenBtn.addEventListener('click', () => {
                tokenModal.style.display = 'none';
            });

            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });
        }

        function login() {
            const username = usernameInput.value;
            const password = passwordInput.value;

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isAdmin = true;
                document.body.classList.add('admin-mode');
                adminLoginBtn.classList.add('admin-active');
                loginModal.style.display = 'none';
                usernameInput.value = '';
                passwordInput.value = '';
                renderData();
                showToast('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            } else {
                showToast('ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©', 'error');
                usernameInput.focus();
            }
        }

        function logout() {
            if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ÿü')) {
                isAdmin = false;
                editingArchiveIndex = null;
                document.body.classList.remove('admin-mode');
                adminLoginBtn.classList.remove('admin-active');
                editModeBadge.style.display = 'none';
                renderData();
                showToast('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨', 'success');
            }
        }

        function renderData() {
            renderEvents();
            renderSpecialEvents();
            renderPayments();
            calculateTotals();
        }

        function renderEvents() {
            eventsTableBody.innerHTML = '';
            window.appData.currentCycle.events.forEach((event, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="name" 
                        data-index="${index}">${event.name || ''}</td>
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="date" 
                        data-index="${index}" 
                        style="direction: ltr; text-align: center; font-family: monospace;">${event.date}</td>
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="amount" 
                        data-index="${index}">${event.amount}</td>
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="additionalAmount" 
                        data-index="${index}">${event.additionalAmount || 0}</td>
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="addedBy" 
                        data-index="${index}">${event.addedBy || ''}</td>
                    <td class="admin-only-column">
                        <button class="delete-btn" data-type="event" data-index="${index}">
                            ‚úï
                        </button>
                    </td>
                `;
                eventsTableBody.appendChild(row);
            });

            if (isAdmin) {
                addEditableListeners('eventsTable', 'event');
            }
        }

        function renderSpecialEvents() {
            specialEventsTableBody.innerHTML = '';
            window.appData.currentCycle.specialEvents.forEach((event, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="name" 
                        data-index="${index}">${event.name || ''}</td>
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="date" 
                        data-index="${index}" 
                        style="direction: ltr; text-align: center; font-family: monospace;">${event.date}</td>
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="amount" 
                        data-index="${index}">${event.amount}</td>
                    <td class="admin-only-column">
                        <button class="delete-btn" data-type="specialEvent" data-index="${index}">
                            ‚úï
                        </button>
                    </td>
                `;
                specialEventsTableBody.appendChild(row);
            });

            if (isAdmin) {
                addEditableListeners('specialEventsTable', 'specialEvent');
            }

            const specialTotal = window.appData.currentCycle.specialEvents.reduce((total, event) => 
                total + (event.amount || 0), 0);
            specialEventsTotalEl.textContent = specialTotal + ' ÿ±ŸäÿßŸÑ';
        }

        function renderPayments() {
            paymentsTableBody.innerHTML = '';
            window.appData.currentCycle.payments.forEach((payment, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="name" 
                        data-index="${index}">${payment.name || ''}</td>
                    <td class="${isAdmin ? 'editable' : ''}" 
                        ${isAdmin ? 'contenteditable="true"' : ''} 
                        data-field="amount" 
                        data-index="${index}">${payment.amount}</td>
                    <td class="admin-only-column">
                        <button class="delete-btn" data-type="payment" data-index="${index}">
                            ‚úï
                        </button>
                    </td>
                `;
                paymentsTableBody.appendChild(row);
            });

            if (isAdmin) {
                addEditableListeners('paymentsTable', 'payment');
            }
        }

        function addEditableListeners(tableId, type) {
            const table = document.getElementById(tableId);
            const editableCells = table.querySelectorAll('.editable');

            editableCells.forEach(cell => {
                cell.addEventListener('input', function() {
                    const index = this.getAttribute('data-index');
                    const field = this.getAttribute('data-field');
                    let value = this.textContent.trim();
                    
                    value = toEnglishNumerals(value);
                    
                    if (type === 'event') {
                        if (field === 'amount' || field === 'additionalAmount') {
                            const numValue = parseInt(value.replace(/[^\d]/g, '')) || 0;
                            window.appData.currentCycle.events[index][field] = numValue;
                            this.textContent = numValue;
                        } else if (field === 'date') {
                            if (validateHijriDate(value)) {
                                const formattedDate = formatHijriDate(value);
                                window.appData.currentCycle.events[index][field] = formattedDate;
                                this.textContent = formattedDate;
                            } else {
                                this.textContent = window.appData.currentCycle.events[index][field];
                                showToast('ÿ™ÿßÿ±ŸäÿÆ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠. ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ™ŸÜÿ≥ŸäŸÇ: YYYY/MM/DD', 'error');
                            }
                        } else {
                            window.appData.currentCycle.events[index][field] = value;
                        }
                    } else if (type === 'specialEvent') {
                        if (field === 'amount') {
                            const numValue = parseInt(value.replace(/[^\d]/g, '')) || 0;
                            window.appData.currentCycle.specialEvents[index][field] = numValue;
                            this.textContent = numValue;
                        } else if (field === 'date') {
                            if (validateHijriDate(value)) {
                                const formattedDate = formatHijriDate(value);
                                window.appData.currentCycle.specialEvents[index][field] = formattedDate;
                                this.textContent = formattedDate;
                            } else {
                                this.textContent = window.appData.currentCycle.specialEvents[index][field];
                                showToast('ÿ™ÿßÿ±ŸäÿÆ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠. ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ™ŸÜÿ≥ŸäŸÇ: YYYY/MM/DD', 'error');
                            }
                        } else {
                            window.appData.currentCycle.specialEvents[index][field] = value;
                        }
                    } else {
                        if (field === 'amount') {
                            const numValue = parseInt(value.replace(/[^\d]/g, '')) || 0;
                            window.appData.currentCycle.payments[index][field] = numValue;
                            this.textContent = numValue;
                        } else {
                            window.appData.currentCycle.payments[index][field] = value;
                        }
                    }

                    if (type === 'specialEvent') {
                        renderSpecialEvents();
                    } else {
                        calculateTotals();
                    }
                });
            });

            const deleteButtons = table.querySelectorAll('.delete-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const index = this.getAttribute('data-index');
                    const type = this.getAttribute('data-type');
                    
                    if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ≥ÿ¨ŸÑÿü')) {
                        if (type === 'event') {
                            window.appData.currentCycle.events.splice(index, 1);
                        } else if (type === 'specialEvent') {
                            window.appData.currentCycle.specialEvents.splice(index, 1);
                        } else {
                            window.appData.currentCycle.payments.splice(index, 1);
                        }
                        renderData();
                        showToast('ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    }
                });
            });
        }

        function addNewEvent() {
            window.appData.currentCycle.events.push({
                name: 'ÿ≠ÿØÿ´ ÿ¨ÿØŸäÿØ',
                date: getHijriDate(),
                amount: 500,
                additionalAmount: 0,
                addedBy: ''
            });
            renderData();
            
            setTimeout(() => {
                const lastRow = eventsTableBody.lastElementChild;
                const firstCell = lastRow.querySelector('.editable');
                if (firstCell) {
                    firstCell.focus();
                    const range = document.createRange();
                    const sel = window.getSelection();
                    range.selectNodeContents(firstCell);
                    range.collapse(false);
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            }, 100);
        }

        function addNewSpecialEvent() {
            window.appData.currentCycle.specialEvents.push({
                name: 'ÿ≠ÿØÿ´ ÿÆÿßÿµ',
                date: getHijriDate(),
                amount: 500
            });
            renderData();
            
            setTimeout(() => {
                const lastRow = specialEventsTableBody.lastElementChild;
                const firstCell = lastRow.querySelector('.editable');
                if (firstCell) {
                    firstCell.focus();
                    const range = document.createRange();
                    const sel = window.getSelection();
                    range.selectNodeContents(firstCell);
                    range.collapse(false);
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            }, 100);
        }

        function addNewPayment() {
            window.appData.currentCycle.payments.push({
                name: 'ÿØŸÅÿπÿ© ÿ¨ÿØŸäÿØÿ©',
                amount: 500
            });
            renderData();
            
            setTimeout(() => {
                const lastRow = paymentsTableBody.lastElementChild;
                const firstCell = lastRow.querySelector('.editable');
                if (firstCell) {
                    firstCell.focus();
                    const range = document.createRange();
                    const sel = window.getSelection();
                    range.selectNodeContents(firstCell);
                    range.collapse(false);
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            }, 100);
        }

        function calculateTotals() {
            const eventsTotal = window.appData.currentCycle.events.reduce((total, event) => 
                total + (event.amount || 0) + (event.additionalAmount || 0), 0);
            const paymentsTotal = window.appData.currentCycle.payments.reduce((total, payment) => 
                total + (payment.amount || 0), 0);
            const remaining = paymentsTotal - eventsTotal;

            eventsTotalEl.textContent = eventsTotal + ' ÿ±ŸäÿßŸÑ';
            paymentsTotalEl.textContent = paymentsTotal + ' ÿ±ŸäÿßŸÑ';
            remainingAmountEl.innerHTML = `<span class="${remaining >= 0 ? 'positive' : 'negative'}">${remaining} ÿ±ŸäÿßŸÑ</span>`;

            summaryEventsEl.textContent = eventsTotal;
            summaryPaymentsEl.textContent = paymentsTotal;
            summaryRemainingEl.innerHTML = `<span class="${remaining >= 0 ? 'positive' : 'negative'}">${remaining}</span>`;
        }

        function startNewCycle() {
            if (!confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ£ÿ±ÿ¥ŸÅÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ© ŸàÿßŸÑÿ®ÿØÿ° ŸÖŸÜ ÿ¨ÿØŸäÿØÿü')) {
                return;
            }

            const eventsTotal = window.appData.currentCycle.events.reduce((t, e) => 
                t + (e.amount || 0) + (e.additionalAmount || 0), 0);
            const paymentsTotal = window.appData.currentCycle.payments.reduce((t, p) => 
                t + (p.amount || 0), 0);

            const archiveEntry = {
                id: Date.now(),
                name: `ÿØŸàÿ±ÿ© ${window.appData.currentCycle.startDate}`,
                startDate: window.appData.currentCycle.startDate,
                endDate: window.appData.currentCycle.currentDate,
                events: [...window.appData.currentCycle.events],
                specialEvents: [...window.appData.currentCycle.specialEvents],
                payments: [...window.appData.currentCycle.payments],
                totalEvents: eventsTotal,
                totalPayments: paymentsTotal,
                remaining: paymentsTotal - eventsTotal,
                archivedDate: new Date().toLocaleDateString('ar-SA', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                })
            };

            if (!window.appData.archive) {
                window.appData.archive = [];
            }
            window.appData.archive.unshift(archiveEntry);

            const today = getHijriDate();
            window.appData.currentCycle = {
                events: [],
                specialEvents: [],
                payments: [],
                currentDate: today,
                startDate: today
            };

            renderData();
            showToast('ÿ™ŸÖ ÿßŸÑÿ£ÿ±ÿ¥ŸÅÿ© ŸàÿßŸÑÿ®ÿØÿ° ÿ®ÿØŸàÿ±ÿ© ÿ¨ÿØŸäÿØÿ©', 'success');
        }

        function editArchiveCycle(index) {
            if (!confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≠ŸÖŸäŸÑ Ÿáÿ∞Ÿá ÿßŸÑÿØŸàÿ±ÿ© ŸÑŸÑÿ™ÿπÿØŸäŸÑÿü')) {
                return;
            }

            if (window.appData.currentCycle.events.length > 0 || window.appData.currentCycle.payments.length > 0) {
                const eventsTotal = window.appData.currentCycle.events.reduce((t, e) => 
                    t + (e.amount || 0) + (e.additionalAmount || 0), 0);
                const paymentsTotal = window.appData.currentCycle.payments.reduce((t, p) => 
                    t + (p.amount || 0), 0);

                const tempArchive = {
                    id: Date.now(),
                    name: `ÿØŸàÿ±ÿ© ${window.appData.currentCycle.startDate}`,
                    startDate: window.appData.currentCycle.startDate,
                    endDate: window.appData.currentCycle.currentDate,
                    events: [...window.appData.currentCycle.events],
                    specialEvents: [...window.appData.currentCycle.specialEvents],
                    payments: [...window.appData.currentCycle.payments],
                    totalEvents: eventsTotal,
                    totalPayments: paymentsTotal,
                    remaining: paymentsTotal - eventsTotal,
                    archivedDate: new Date().toLocaleDateString('ar-SA', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    })
                };
                window.appData.archive.unshift(tempArchive);
            }

            const archiveCycle = window.appData.archive[index];
            window.appData.currentCycle = {
                events: archiveCycle.events.map(event => ({
                    ...event,
                    date: formatHijriDate(event.date)
                })),
                specialEvents: (archiveCycle.specialEvents || []).map(event => ({
                    ...event,
                    date: formatHijriDate(event.date)
                })),
                payments: [...archiveCycle.payments],
                currentDate: formatHijriDate(archiveCycle.endDate),
                startDate: formatHijriDate(archiveCycle.startDate)
            };

            window.appData.archive.splice(index, 1);
            editingArchiveIndex = index;
            editModeBadge.style.display = 'flex';

            closeArchive();
            renderData();
            
            showToast('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿØŸàÿ±ÿ© ŸÑŸÑÿ™ÿπÿØŸäŸÑ', 'success');
        }

        function showArchive() {
            if (!window.appData.archive || window.appData.archive.length === 0) {
                showToast('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ§ÿ±ÿ¥ŸÅÿ©', 'warning');
                return;
            }

            let archiveHTML = `
                <div class="archive-modal">
                    <div class="archive-container">
                        <h2 style="text-align: center; margin-bottom: 28px; color: var(--text-primary);">
                            ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ
                        </h2>
            `;

            window.appData.archive.forEach((cycle, index) => {
                archiveHTML += `
                    <div class="archive-item">
                        <h3>
                            ${cycle.name}
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: 14px; font-size: 0.875rem; direction: ltr; text-align: right;">
                            ŸÖŸÜ ${formatHijriDate(cycle.startDate)} ÿ•ŸÑŸâ ${formatHijriDate(cycle.endDate)}
                            <br>
                            ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ£ÿ±ÿ¥ŸÅÿ©: ${cycle.archivedDate}
                        </p>
                        <div class="archive-stats">
                            <div class="stat-box">
                                <div class="stat-label">ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿßÿ™</div>
                                <div class="stat-value">${cycle.totalEvents}</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">ÿßŸÑÿØŸÅÿπÿßÿ™</div>
                                <div class="stat-value">${cycle.totalPayments}</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">ÿßŸÑŸÖÿ™ÿ®ŸÇŸä</div>
                                <div class="stat-value" style="color: ${cycle.remaining >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                                    ${cycle.remaining}
                                </div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button onclick="viewCycleDetails(${index})" class="btn btn-primary btn-sm">
                                ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ
                            </button>
                            ${isAdmin ? `
                            <button onclick="editArchiveCycle(${index})" class="btn btn-warning btn-sm">
                                ÿ™ÿπÿØŸäŸÑ
                            </button>
                            <button onclick="deleteCycle(${index})" class="btn btn-danger btn-sm">
                                ÿ≠ÿ∞ŸÅ
                            </button>` : ''}
                        </div>
                    </div>
                `;
            });

            archiveHTML += `
                        <button onclick="closeArchive()" class="btn btn-primary full-width-btn" style="margin-top: 20px;">
                            ÿ•ÿ∫ŸÑÿßŸÇ
                        </button>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', archiveHTML);
        }

        window.viewCycleDetails = function(index) {
            const cycle = window.appData.archive[index];
            
            let detailsHTML = `
                <div class="archive-modal">
                    <div class="archive-container" style="max-width: 850px;">
                        <h2 style="text-align: center; margin-bottom: 24px; font-size: 1.3rem;">
                            ${cycle.name}
                        </h2>
                        
                        <div style="background: var(--bg-secondary); padding: 16px; border-radius: 10px; margin-bottom: 20px; font-size: 0.875rem; border: 1px solid var(--border-color); direction: ltr; text-align: right;">
                            <p><strong>ÿßŸÑŸÅÿ™ÿ±ÿ©:</strong> ${formatHijriDate(cycle.startDate)} - ${formatHijriDate(cycle.endDate)}</p>
                            <p style="margin-top: 6px;"><strong>ÿßŸÑÿ£ÿ±ÿ¥ŸÅÿ©:</strong> ${cycle.archivedDate}</p>
                        </div>

                        <h3 style="margin: 20px 0 14px; color: var(--text-primary); font-size: 1.05rem;">
                            ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ (${cycle.events.length})
                        </h3>
                        <div class="table-container" style="border: 1px solid var(--border-color); border-radius: 8px;">
                            <table style="font-size: 0.85rem;">
                                <thead>
                                    <tr>
                                        <th>ÿßŸÑÿßÿ≥ŸÖ</th>
                                        <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                                        <th>ÿßŸÑŸÖÿ®ŸÑÿ∫</th>
                                        <th>ÿ•ÿ∂ÿßŸÅÿ©</th>
                                        <th>ŸÖŸÜ</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;

            cycle.events.forEach(event => {
                detailsHTML += `
                    <tr>
                        <td>${event.name}</td>
                        <td style="direction: ltr; text-align: center; font-family: monospace;">${formatHijriDate(event.date)}</td>
                        <td>${event.amount}</td>
                        <td>${event.additionalAmount || 0}</td>
                        <td>${event.addedBy || '-'}</td>
                    </tr>
                `;
            });

            detailsHTML += `
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="4">ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</td>
                                        <td>${cycle.totalEvents} ÿ±ŸäÿßŸÑ</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                        <h3 style="margin: 20px 0 14px; color: var(--accent-green); font-size: 1.05rem;">
                            ÿßŸÑÿØŸÅÿπÿßÿ™ (${cycle.payments.length})
                        </h3>
                        <div class="table-container" style="border: 1px solid var(--border-color); border-radius: 8px;">
                            <table style="font-size: 0.85rem;">
                                <thead>
                                    <tr>
                                        <th>ÿßŸÑÿßÿ≥ŸÖ</th>
                                        <th>ÿßŸÑŸÖÿ®ŸÑÿ∫</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;

            cycle.payments.forEach(payment => {
                detailsHTML += `
                    <tr>
                        <td>${payment.name}</td>
                        <td>${payment.amount} ÿ±ŸäÿßŸÑ</td>
                    </tr>
                `;
            });

            detailsHTML += `
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</td>
                                        <td>${cycle.totalPayments} ÿ±ŸäÿßŸÑ</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                        <div style="background: var(--bg-secondary); padding: 20px; border-radius: 10px; margin-top: 20px; text-align: center; border: 1px solid var(--border-color);">
                            <h3 style="color: ${cycle.remaining >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}; font-size: 1.2rem;">
                                ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: ${cycle.remaining} ÿ±ŸäÿßŸÑ
                            </h3>
                        </div>

                        <button onclick="closeArchive()" class="btn btn-primary full-width-btn" style="margin-top: 20px;">
                            ÿ±ÿ¨Ÿàÿπ
                        </button>
                    </div>
                </div>
            `;

            closeArchive();
            document.body.insertAdjacentHTML('beforeend', detailsHTML);
        };

        window.deleteCycle = function(index) {
            if (confirm('‚ö†Ô∏è ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿØŸàÿ±ÿ©ÿü')) {
                window.appData.archive.splice(index, 1);
                closeArchive();
                showArchive();
                showToast('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿØŸàÿ±ÿ©', 'success');
            }
        };

        window.closeArchive = function() {
            const modal = document.querySelector('.archive-modal');
            if (modal) modal.remove();
        };

        window.editArchiveCycle = editArchiveCycle;

        async function saveDataToGitHub() {
            const token = githubTokenInput.value.trim();
            
            if (!token) {
                showToast('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ Token', 'error');
                githubTokenInput.focus();
                return;
            }

            window.appData.lastUpdate = new Date().toLocaleString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            progressContainer.style.display = 'block';
            updateProgress(10);

            try {
                // ÿ£ŸàŸÑÿßŸã: ÿ¨ŸÑÿ® ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ≠ÿßŸÑŸä ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ SHA
                updateProgress(30);
                let sha = null;
                let fileExists = false;
                
                try {
                    const getResponse = await fetch(GITHUB_API_URL, {
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (getResponse.ok) {
                        const fileInfo = await getResponse.json();
                        sha = fileInfo.sha;
                        fileExists = true;
                        showToast('ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑŸÖŸÑŸÅÿå ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´...', 'success');
                    } else if (getResponse.status === 404) {
                        showToast('ÿ≥Ÿäÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ ÿ¨ÿØŸäÿØ', 'warning');
                    } else {
                        const errorData = await getResponse.json();
                        throw new Error(`ŸÅÿ¥ŸÑ ŸÅŸä ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ: ${errorData.message || getResponse.status}`);
                    }
                } catch (error) {
                    throw new Error(`ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ: ${error.message}`);
                }

                updateProgress(60);

                // ÿ™ÿ≠ÿ∂Ÿäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                const dataStr = JSON.stringify(window.appData, null, 2);
                
                // ÿ™ÿ≠ŸàŸäŸÑ ÿ•ŸÑŸâ base64 ÿ®ÿ¥ŸÉŸÑ ÿµÿ≠Ÿäÿ≠
                const base64Data = btoa(unescape(encodeURIComponent(dataStr)));

                const body = {
                    message: `ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜÿßÿ≥ÿ®ÿßÿ™ ÿßŸÑŸÉÿ¥Ÿàÿ¥ - ${window.appData.lastUpdate}`,
                    content: base64Data,
                    committer: {
                        name: 'Kashoosh App',
                        email: 'kashoosh@example.com'
                    }
                };

                // ÿ•ÿ∂ÿßŸÅÿ© SHA ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖŸÑŸÅ ŸÖŸàÿ¨ŸàÿØÿßŸã
                if (sha) {
                    body.sha = sha;
                }

                updateProgress(80);

                // ÿ±ŸÅÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                const updateResponse = await fetch(GITHUB_API_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify(body)
                });

                updateProgress(95);

                if (!updateResponse.ok) {
                    const errorData = await updateResponse.json();
                    let errorMsg = 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™';
                    if (errorData.message) {
                        errorMsg += `: ${errorData.message}`;
                        
                        // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿÆÿ∑ÿ£ ŸÖŸÅŸäÿØÿ©
                        if (errorData.message.includes('bad credentials')) {
                            errorMsg = 'Token ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÄ Token';
                        } else if (errorData.message.includes('Not Found')) {
                            errorMsg = 'ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ ÿ£Ÿà ŸÑŸäÿ≥ ŸÑÿØŸäŸÉ ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸäŸá';
                        } else if (errorData.message.includes('This repository is empty')) {
                            errorMsg = 'ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ŸÅÿßÿ±ÿ∫. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ŸÖŸÑŸÅ data.json ŸÅŸä ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ';
                        }
                    }
                    throw new Error(errorMsg);
                }

                updateProgress(100);

                setTimeout(() => {
                    tokenModal.style.display = 'none';
                    showToast('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠ ÿπŸÑŸâ GitHub!', 'success');
                    progressContainer.style.display = 'none';
                    lastUpdateEl.textContent = window.appData.lastUpdate;
                    editModeBadge.style.display = 'none';
                    editingArchiveIndex = null;
                    githubTokenInput.value = '';
                    
                    // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ÿπÿØ ÿßŸÑÿ≠ŸÅÿ∏ ŸÑŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑŸÖÿ≤ÿßŸÖŸÜÿ©
                    setTimeout(() => {
                        loadDataFromGitHub().then(() => {
                            renderData();
                            showToast('ÿ™ŸÖ ŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿπ GitHub', 'success');
                        });
                    }, 1000);
                    
                }, 500);

            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏:', error);
                showToast(`ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≠ŸÅÿ∏: ${error.message}`, 'error');
                progressContainer.style.display = 'none';
                
                // ÿπÿ±ÿ∂ ÿÆŸäÿßÿ± ŸÜÿ≥ÿÆ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸäÿØŸàŸäÿßŸã
                if (confirm('ŸÅÿ¥ŸÑ ÿßŸÑÿ≠ŸÅÿ∏ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä. ŸáŸÑ ÿ™ÿ±ŸäÿØ ŸÜÿ≥ÿÆ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸäÿØŸàŸäÿßŸãÿü')) {
                    showDataForCopy();
                }
            }
        }

        function updateProgress(percent) {
            progressBar.style.width = `${percent}%`;
        }

        function showDataForCopy() {
            window.appData.lastUpdate = new Date().toLocaleString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            const dataDisplay = document.createElement('div');
            dataDisplay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: var(--bg-primary); z-index: 9999; padding: 20px; overflow: auto;
            `;

            const textarea = document.createElement('textarea');
            textarea.value = JSON.stringify(window.appData, null, 2);
            textarea.readOnly = true;
            textarea.style.cssText = `
                width: 100%; height: 75%; border: 2px solid var(--accent-blue);
                border-radius: 10px; padding: 16px; font-family: monospace;
                font-size: 13px; resize: none; background: var(--bg-secondary);
                color: var(--text-primary);
            `;

            const instructions = document.createElement('div');
            instructions.style.cssText = `
                background: var(--bg-secondary);
                padding: 15px;
                border-radius: 8px;
                margin: 15px 0;
                border: 1px solid var(--border-color);
                font-size: 0.9rem;
                color: var(--text-secondary);
            `;
            instructions.innerHTML = `

            `;

            const controls = document.createElement('div');
            controls.style.cssText = `
                display: flex; gap: 10px; margin-top: 16px; justify-content: center;
            `;

            const copyBtn = document.createElement('button');
            copyBtn.className = 'btn btn-primary';
            copyBtn.textContent = 'ŸÜÿ≥ÿÆ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™';

            const closeBtn = document.createElement('button');
            closeBtn.className = 'btn btn-danger';
            closeBtn.textContent = 'ÿ•ÿ∫ŸÑÿßŸÇ';

            dataDisplay.appendChild(textarea);
            dataDisplay.appendChild(instructions);
            controls.appendChild(copyBtn);
            controls.appendChild(closeBtn);
            dataDisplay.appendChild(controls);
            document.body.appendChild(dataDisplay);

            textarea.select();

            copyBtn.addEventListener('click', () => {
                textarea.select();
                document.execCommand('copy');
                showToast('ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™!', 'success');
            });

            closeBtn.addEventListener('click', () => {
                document.body.removeChild(dataDisplay);
                tokenModal.style.display = 'none';
            });
        }

        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
